-- =============================================
-- таблица категорий
-- =============================================
create table categories
(
    category_id serial primary key,
    name        varchar(100) not null unique,
    description text
);

-- =============================================
-- таблица продуктов
-- =============================================
create table products
(
    product_id        serial primary key,
    category_id       integer                     not null references categories (category_id) on delete restrict on update cascade,
    name              varchar(200)                not null,
    image_url         varchar(255)                not null,
    alt_text          varchar(255)                not null,
    description       text                        not null,
    short_description varchar(500)                not null,
    price             decimal(10, 2)              not null check (price > 0),
    volume            decimal(3, 2)               not null check (volume > 0),
    additional_images varchar(255)[] default '{}',
    is_active         boolean        default true not null
);

-- =============================================
-- таблица клиентов
-- =============================================
create table customers
(
    customer_id   serial primary key,
    first_name    varchar(100)        not null,
    email         varchar(255) unique not null check (email ~* '^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$'),
    password_hash varchar(255)        not null,
    phone         varchar(20)
);

-- =============================================
-- таблица отзывов
-- =============================================
create table reviews
(
    review_id   serial primary key,
    product_id  integer                               not null references products (product_id) on delete cascade on update cascade,
    customer_id integer                               not null references customers (customer_id) on delete cascade on update cascade,
    review_text text                                  not null,
    rating      integer                               not null check (rating >= 1 and rating <= 5),
    is_approved boolean     default true              not null,
    created_at  timestamptz default current_timestamp not null,
    -- один пользователь может оставить только один отзыв на товар
    unique (product_id, customer_id)
);

-- =============================================
-- заполнение тестовыми данными
-- =============================================

-- категории
insert into categories (name, description)
values ('сокосодержащие напитки', 'Ты то, что ты пьешь. Какой напиток лучше всего выбрать на каждый день, чтобы было и вкусно, и полезно? Весь мир уже знает ответ на этот вопрос: конечно напитки безалкогольные с добавлением сока идеально вписывающиеся в глобальный тренд на здоровый образ жизни!

Натуральная польза и кладовые витамины для детей и взрослых — без консервантов. Только натуральный сок и чистая питьевая вода.'),
       ('холодный чай', 'Холодный чай IceTea — уникален по своей натуральности и использованию напитка без консервантов. Асептическая линия производства позволяет сохранить все полезные свойства растительных экстрактов и натуральных ингредиентов.

Для его производства используется высококлассный настоящий зелёный и чёрный экстракт чая.

IceTea – это только экстракт чая, чистая питьевая вода, содержащие ароматизаторы и немного лимонной кислоты для раскрытия полноты вкуса напитков.'),
       ('минеральная вода', 'Вода минеральная природная питьевая лечебно-столовая «Липецкая» считается одной из лучших по медико-биологическим показателям не только в России. Мы добываем ее из подземного источника глубиной 601 метр.



Вода разливается в последовательном каскаде от источника добычи воды (скважины питьевой и минеральной воды находятся на расстоянии 145-250 м от отделения водоподготовки цеха розлива), а значит сохраняется в первозданном виде свою чистоту, особенный незабываемый вкус и все ценные полезные свойства.'),
       ('минеральная вода с соком',
        'Напитки безалкогольные на основе минеральной природной воды «Липецкая Росинка» - низкокалорийный напиток для активной и продолжительной активности: минеральная вода помогает восстановить водно-солевой баланс и утолить жажду, натуральный сок — получить удовольствие от яркого вкуса. Плюс совсем немного сахара для сбалансированной работы организма'),
       ('party time',
        'Напиток безалкогольный сильногазированный Party Time — это настоящий прорыв в мирнапитков. Мы создали безупречное качество, оригинальный вкус и современный дизайн, который привлекает внимание.');

-- Сокосодержащие напитки (category_id = 1)
INSERT INTO products (category_id, name, image_url, alt_text, description, short_description, price, volume, is_active)
VALUES
    (1, 'Фрутмотив "Киви фейхоа" 1.5 л',
     '/assets/cards/6855163dc9935a82f345b7a8_Рендер киви фейхоа (1).webp',
     'Фрутмотив Киви Фейхоа',
     'Откройте для себя уникальный вкус и пользу нашего напитка, сочетающего в себе свежие ноты киви и экзотический аромат фейхоа. Киви придает напитку нежную кисло-сладкую нотку, тогда как фейхоа добавляет утонченные тропические акценты. Вместе они создают гармоничное сочетание, которое порадует даже самых искушенных гурманов.',
     'Откройте для себя уникальный вкус и пользу нашего напитка...',
     100.00, 1.50, true),

    (1, 'Фрутмотив "Лимон сорбет" 1.5 л',
     '/assets/cards/685513660e79cf3d949c27a7_Рендер Лимон сорбет (1).webp',
     'Фрутмотив Лимон сорбет',
     'Побалуйте себя освежающей прохладой нашего сокосодержащего напитка с ярким вкусом лимонного сорбета. Легкая сладость и тонкая цитрусовая кислинка создадут ощущение, словно вы наслаждаетесь классическим итальянским десертом прямо из солнечной Италии. Вкус лимонного сорбета сочетает в себе сбалансированную кислотность и сладость, оставляя приятное освежающее послевкусие.',
     'Побалуйте себя освежающей прохладой нашего сокосодержащего напитка...',
     100.00, 1.50, true),

    (1, 'Фрутмотив «Апельсин»',
     '/assets/cards/6855100cb4dd419336061991_Апельсин_1и5л.webp',
     'Фрутмотив Апельсин',
     'Яркий, солнечный, нежный и не слишком сладкий апельсиновый «Фрутмотив» станет символом каждого твоего дня. Сахара меньше, а пользы для организма больше. Посмотри, как искрится и рвется наружу его оранжевая энергия!',
     'Яркий, солнечный, нежный и не слишком сладкий апельсиновый «Фрутмотив»...',
     100.00, 1.50, true),

-- Холодный чай (category_id = 2)
    (2, 'Фрутмотив IceTea «Манго-ананас»',
     '/assets/cards/66deabbc035e08338ea00f93_чай_манго 1,5.webp',
     'Фрутмотив IceTea Манго-ананас',
     'Яркая летняя новинка! Сладкий романтичный ароматный манго в сочетании с дерзким свежим ананасом доставят истинное наслаждение в любой день. Просто закройте глаза, попробуйте и почувствуйте себя на жаркой вечеринке на берегу моря.',
     'Яркая летняя новинка! Сладкий романтичный ароматный манго...',
     100.00, 1.50, true),

    (2, 'Фрутмотив IceTea «Лесные ягоды»',
     '/assets/cards/66deac2e04e529dab715923b_чай_ягоды 1,5.webp',
     'Фрутмотив IceTea Лесные ягоды',
     'Один глоток этого ароматного холодного чая перенесет вас в погожие деньки. Мы сохранили лето в бутылке! Оказалось, что нужно только добавить к натуральному чёрному чаю яркие ноты клубники, малины и черники, охладить — и можно ежедневно вспоминать тёплые деньки за городом.',
     'Один глоток этого ароматного холодного чая перенесет вас в погожие деньки...',
     100.00, 1.50, true),

    (2, 'Фрутмотив IceTea «Лимон»',
     '/assets/cards/66deac04ad046337efdfa307_чай_лимон 1,5.webp',
     'Фрутмотив IceTea Лимон',
     'Чёрный холодный чай и лимон — это идеальное сочетание. Классический вкус, равных которому нет. В жаркий день он утолит жажду, а в холод напомнит о лете и придаст сил.',
     'Чёрный холодный чай и лимон — это идеальное сочетание...',
     100.00, 1.50, true),

-- Минеральная вода (category_id = 3)
    (3, 'Росинка «ароматизированная не газированная» со вкусом малины',
     '/assets/cards/6855400757edc931633c2b9c_питьевая 15 малина.png',
     'Росинка ароматизированная не газированная со вкусом малины',
     'Ароматизированная негазированная вода со вкусом малины',
     'Ароматизированная негазированная вода со вкусом малины',
     100.00, 1.50, true),

    (3, 'Росинка «ароматизированная не газированная» со вкусом лимона',
     '/assets/cards/68553cb64c874674407a7ccb_питьевая 15 лимон.webp',
     'Росинка ароматизированная не газированная со вкусом лимона',
     'Ароматизированная негазированная вода со вкусом лимона',
     'Ароматизированная негазированная вода со вкусом лимона',
     100.00, 1.50, true),

    (3, 'Росинка «ароматизированная не газированная» со вкусом клубники',
     '/assets/cards/68553a594c874674407902c4_питьевая 15 клубника.webp',
     'Росинка ароматизированная не газированная со вкусом клубники',
     'Ароматизированная негазированная вода со вкусом клубники',
     'Ароматизированная негазированная вода со вкусом клубники',
     100.00, 1.50, true);

-- Проверка
SELECT p.product_id, p.name, c.name as category
FROM products p
         JOIN categories c ON p.category_id = c.category_id;